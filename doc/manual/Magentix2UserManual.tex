\documentclass[twoside,a4paper,11pt,titlepage]{report}

\usepackage[pdftex]{graphicx} %paquete para incluir imagenes
%\usepackage{graphicx} %paquete para incluir imagenes
\usepackage{anysize} %para especificar el tamaño del papel
\usepackage{miapalike} %Formato bibliografía, adaptado del paquete apalike
\usepackage{setspace} %para especificar el interlineado
\usepackage{fancyhdr} %Cabeceras y pies de páginas
\usepackage{multirow} %Usado para las tablas. Permite que una celda cubra múltiples filas
\usepackage{enumerate} %The enumerate package adds an optional argument to the enumerate environment which determines the style in which the counter is printed.
%%%\usepackage{stmaryrd} %para usar operadores binarios como el cuadradito vacio
%\usepackage{amsmath}

\usepackage[footnotesize,bf]{caption} %para cambiar el tamaño de letra de la leyenda de las figuras y tablas, con las opciones indicadas pongo el tamaño de letra al tamaño de las notas al pie y "`Figura x"' en negrita.

\usepackage[pdfborder={0 0 0},plainpages=false]{hyperref} %% para que las entradas de los indices se conviertan en vínculos
%\usepackage[pdftex=true,pdfborder={0 0 0},plainpages=false]{hyperref} %% para que las entradas de los indices se conviertan en vínculos
\usepackage{url}  % enter URLs like this: \url{http://www.stack.nl/~jwk/latex/}. 
\usepackage{fancybox}%Variants of \fbox and other games with boxes. 
\usepackage{times} %A package to use PostScript Times Roman as the default font.
\usepackage{color} %The color package provides both foreground (text, rules, etc.) and background colour management; it uses the device driver configuration mechanisms of the graphics package to determine how to control its ouptut. 
\usepackage{epstopdf} %Para transformaar los eps a pdf
\usepackage{rotating} %Para rotar tablas y figuras
\usepackage{amsmath, amssymb}
\usepackage{tabulary}

\newtheorem{definition}{Definition}[section]

    

\usepackage{fancyvrb} % This package provides very sophisticated facilities for reading and writing verbatim TEX code

\papersize{29.7cm}{21cm} \marginsize{3.5cm}{3cm}{3cm}{3cm} %%Se marca el tamaño del papel, usando el paquete anysize
\newcommand{\clearemptydoublepage}{\newpage{\pagestyle{empty}\cleardoublepage}} %% Para asegurarse que siempre se comienza un capítulo en la siguiente página

%%%%% FORMATO Cabecera y pie de páginas
\pagestyle{fancy}
\fancyhf{} % borrar todos los ajustes

\fancyhead[LO]{\leftmark} % En las páginas impares, parte izquierda del encabezado, aparecerá el nombre de capítulo
\fancyhead[RE]{\rightmark} % En las páginas pares, parte derecha del encabezado, aparecerá el nombre de sección
\fancyhead[RO,LE]{\thepage} % Números de página en las esquinas de los encabezados
%\fancyfoot[COE]{\thepage} %Números de página en el pie en el centro

\renewcommand{\chaptermark}[1]{\markboth{\textbf{\thechapter. #1}}{}} % Formato para el capítulo: N. Nombre
\renewcommand{\sectionmark}[1]{\markright{\textbf{\thesection. #1}}} % Formato para la sección: N.M. Nombre

\renewcommand{\headrulewidth}{0.6pt} % Ancho de la línea horizontal bajo el encabezado

\setlength{\headheight}{1.5\headheight} % Aumenta la altura del encabezado en una vez y media


%%%%%%% FIN FORMATO cabecera y pie




%%%%%%%%%%%%%%  FORMATO TÍTULO CAPÍTULOS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage[spanish]{minitoc} %Mini-TOC-> formato de los indices para cada capitulo
\setcounter{minitocdepth}{1} %Profundidad al que llega el indice
\tightmtctrue  %%% Minimum space between lines
\mtcindent=2pt %
\mtcsetformat{minitoc}{dotinterval}{3} %Separación entre puntos
\mtcsetformat{minitoc}{tocrightmargin}{2.55em plus 1fill}
\mtcsetformat{minitoc}{pagenumwidth}{1.55em}
\mtcsetrules{minitoc}{off} %sin lineas arriba y bajo del indice
\makeatletter
\def\thickhrulefill{\leavevmode \leaders \hrule height 1ex \hfill \kern \z@}
\def\@makechapterhead#1{%% Para capítulos numerados
  \reset@font
  \parindent \z@
  \vspace*{10\p@}%
  \hbox{%
    \vbox{\hsize=2cm
      \begin{tabular}{c}
        \scshape \strut \@chapapp{} \\
        \fbox{%
          \vrule depth 10em width 0pt%
          \vrule height 0pt depth 0pt width 1ex%
          {\LARGE \bfseries \strut \thechapter}%
          \vrule height 0pt depth 0pt width 1ex%
          }
      \end{tabular}%
      }%
    \vbox{%
      \advance\hsize by -2cm
      \hrule\par
      \vskip 6pt% 
      \hspace{1em}%
      \Huge \bfseries #1
      }%
    }%
\hbox{%
 \vbox{\hsize=1.9cm
        \vrule depth 0em width 0pt%
 }
 \vbox{\advance\hsize by -2cm
        {\setlength{\linewidth}{9.5cm}
        \mtcsetfont{minitoc}{section}{\small\rmfamily\upshape\bfseries}
        \minitoc}
        \vskip 6pt%
        \hrule\par
 }
}%
  \vskip 15\p@
}
\def\@makeschapterhead#1{%% Para capítulos sin numero
  \reset@font
  \parindent \z@
  \vspace*{10\p@}%
 \hbox{%
    \vbox{\hsize=2cm
      \begin{tabular}{c}
        \scshape \strut \vphantom{\@chapapp{}} \hphantom{\@chapapp{}} \\
        \fbox{%
          \vrule depth 10em width 0pt%
          \vrule height 0pt depth 0pt width 1ex%
          {\LARGE \bfseries \strut \hphantom{\thechapter}}%
          \vrule height 0pt depth 0pt width 1ex%
          }
      \end{tabular}%
      }%
    \vbox{%
      \advance\hsize by -2cm
      \hrule\par
      \vskip 6pt%
      \hspace{1em}%
      \Huge \bfseries #1
      \vskip 6pt%
       \hrule\par
      }%
    }%

 \vskip 15\p@
}
%%%%%%%%%%%%%%  FIN FORMATO CAPÍTULOS %%%%%%%%%%%%%%%%%%%%%%%%%%%%%



%%%%%%%%%%%%%%%%% FORMATO SECCIONES %%%%%%%%%%%%%%%%%%%%%%%%%%
% Con las siguientes instrucciones cambiamos el formato a las secciones y subsecciones,
% para que todas salgan numeradas. Además, añadimos más niveles de anidamiento
\renewcommand\section{\@startsection {section}{1}{\z@}%
                                   {-3.5ex \@plus -1ex \@minus -.2ex}%
                                   {2.3ex \@plus.2ex}%
                                   {\sffamily\Large\bfseries}}
\renewcommand\subsection{\@startsection{subsection}{2}{\z@}%
                                     {-3.25ex\@plus -1ex \@minus -.2ex}%
                                     {1.5ex \@plus .2ex}%
                                     {\sffamily\large\bfseries}}

%%% He cambiado startsection{subsection}{3} por startsection{subsection}{2} con lo que
%%%  se consigue que salgan numerados los títulos
\renewcommand\subsubsection{\@startsection{subsubsection}{2}{\z@}%
                                     {-3.25ex\@plus -1ex \@minus -.2ex}%
                                     {1.5ex \@plus .2ex}%
                                     {\sffamily\normalsize\bfseries}}
%\newcommand\subsubsection{\@startsection{subsubsection}{3}{\z@}%
%                                     {-3.25ex\@plus -1ex \@minus -.2ex}%
%                                     {1.5ex \@plus .2ex}%
%                                     {\normalfont\normalsize\bfseries}}


%%%   Estas definiciones permiten crear subsubsubsection y subsubsubsubsection.
%%%   Si se necesitasen más, se añade lo que se necesita tomando el nivel
%%%     anterior de sub y añadir un "sub" en todas partes y cambiar el indicador
%%%     de nivel de {5} a {6}.

\newcounter{subsubsubsection}[subsubsection]
\def\subsubsubsectionmark#1{}
\def\thesubsubsubsection {\thesubsubsection
     .\arabic{subsubsubsection}}
     
    
    \newcommand\subsubsubsection{\@startsection
     {subsubsubsection}{2}{\z@}%
     {-3.25ex\@plus -1ex \@minus -.2ex}%
     {1.5ex \@plus .2ex}%
     {\sffamily\normalsize\bfseries}}
\def\l@subsubsubsection{\phantomsection
    \@dottedtocline{4}{10.8em}{4.2em}}


%%%%%%%%%%%%%%%%% FIN FORMATO SECCIONES %%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%%%%%%%%%% FORMATOS ENTORNOS ESPECIALES

%%%%% Permite hacer una enumeracion T.1, T.2, T.2.1, etc..
\newenvironment{enumeraTareas}{\renewcommand{\labelenumi}{T.\arabic{enumi}} \renewcommand{\labelenumii}{T.\arabic{enumi}.\arabic{enumii}} \begin{enumerate}}{\end{enumerate}}
\newenvironment{listaguion}{\renewcommand{\labelitemi}{-} \begin{itemize} \setlength{\leftmargin}{8cm} \addtolength{\itemsep}{-0.5\baselineskip}}{\end{itemize}}

%%% Cambiamos la "`,"' decimal por un "`."'
%\spanishdecimal{.} 

%%%%%%%%%%%%%%% Para inclur cosas como el resumen, agradecimientos, etc sin que rompa los minitocs e incluyendo la entrada en el indice

%\newcommand{\prefacesection}[1]{ \chapter*{#1}\addcontentsline{toc}{chapter}{#1}}
\newcommand{\prefacesection}[1]{ \chapter*{#1}\mtcaddchapter[#1]}


%%%%%%%% PAra introducir código o salidas de mensajes por pantalla
\definecolor{grisfondo}{gray}{0.9}

\DefineVerbatimEnvironment{VerbEj}{BVerbatim}{fontsize=\small,samepage=true}
\newenvironment{codigo}%
{\VerbatimEnvironment\begin{Sbox}\begin{VerbEj}}%
{\end{VerbEj}\end{Sbox}\setlength{\fboxsep}{8pt}\begin{center}\fcolorbox{black}{grisfondo}{\TheSbox}\end{center}}

%%%% DEFICINIONES PARA INTRODUCIR CODIGO EN VENTADAS NUMERADAS %%%%%%%%%%%%%%%%


\usepackage{listings} %%Para introducir código: commands  \lstinline \lstlisting
														%\lstinline pretty-prints a line code:‘var i :integer;’ is typeset by ‘\lstinline!var i:integer;!’. 
														%The exclamation marks delimit the code and can be replaced by any character not in the code
														%The lstlisting environment typesets the enclosed source code:
														%\begin{lstlisting}[style=Java]
														%Codigo
														%\end{lstlisting}
														
														
												
\definecolor{gray97}{gray}{.97}
\definecolor{gray75}{gray}{.75}
\definecolor{gray45}{gray}{.45}
 

\lstset{ frame=Ltb,
     framerule=0pt,
     aboveskip=0.5cm,
     framextopmargin=3pt,
     framexbottommargin=3pt,
     framexleftmargin=0.4cm,
     framesep=0pt,
     rulesep=.4pt,
     backgroundcolor=\color{gray97},
     rulesepcolor=\color{black},
     %
     stringstyle=\ttfamily,
     showstringspaces = false,
     basicstyle=\small\ttfamily,
     commentstyle=\color{gray45},
     keywordstyle=\bfseries,
     %
     numbers=left,
     numbersep=15pt,
     numberstyle=\tiny,
     numberfirstline = false,
     breaklines=true,
   }
 
% minimizar fragmentado de listados
%\lstnewenvironment{listing}[1][]
 %  {\lstset{#1}\pagebreak[0]}{\pagebreak[0]}
 
\lstdefinestyle{consola}
   {basicstyle=\scriptsize\bf\ttfamily,
    backgroundcolor=\color{gray75},
   }
 
\lstdefinestyle{Java}
   {language=Java,
}
%%%% DEFICINIONES PARA INTRODUCIR CODIGO EN VENTADAS NUMERADAS %%%%%%%%%%%%%%%%


%%%%%%%%%%%%% FIN ENTORNOS ESPECIALES




%=================== BEGIN DOCUMENT 
 
\begin{document}

\include{InternalCover/InternalCover} %Nueva Portada
\pagestyle{empty}
\clearemptydoublepage


\dominitoc[n] %%%Llamamos al comando para construir los indices de capitulo sin que aparezca titulo

\clearemptydoublepage %

\pagestyle{plain}  
\pagenumbering{Roman} 

\tableofcontents

\clearemptydoublepage
%\renewcommand{\listfigurename}{Lista de Figuras} 
\listoffigures
%\renewcommand{\listtablename}{Índice de tablas} 
\listoftables 




%%%%%%%%    FORMATO PÁRRAFO %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%5
\renewcommand{\baselinestretch}{1.25} % Para ajustar el interlineado

\addtolength{\parskip}{0.5\baselineskip}
%\setlength{\parindent}{3em} %define que la indentación debe ser de 3 espacios 
%\itemsep Separaci´on entre los diferentes elementos de la lista.

%\parsep Espacio vertical entre p´arrafos dentro de un elemento de la lista.

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\clearemptydoublepage
\include{Prefaces/Acknowledgments}

\clearemptydoublepage
\pagenumbering{arabic} 
\pagestyle{fancy}  

\include{Introduction/Introduction} 



\clearemptydoublepage
\include{Quickstart/Quickstart} 								  %Intro del capítulo, primera y segunda sección


\clearemptydoublepage
\include{ProgrammingAgents/ProgrammingAgents} 	%Intro del capítulo, primera, segunda,tercera,cuarta,quinta, sexta, septima y octava     sección 


\clearemptydoublepage
\include{Thomas/ThomasOverview}									%Intro del capítulo y resto de secciones

\clearemptydoublepage
\include{HTTPInterface/HTTPInterface}									%Intro del capítulo y resto de secciones

\clearemptydoublepage
\include{Administration/PlatformAdminIntro}			%Intro del capítulo, primera,  segunda,tercera,cuarta,quinta Y sexta



\clearemptydoublepage
\fancyhead[LO,RE]{\textbf{Bibliography}} %pongo a mano el encabezado de esta sección

\addcontentsline{toc}{chapter}{Bibliography} %%Añado la bibiografía al índice
\bibliographystyle{apalike} %[Author, 1986][Author and Author, 1986][Author et al., 1986]. Multiple references  [Author1, 1986; Author2, 1987]
\bibliography{Magentix2UM}

\end{document}
